"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bus_rdf_source_identifier_1 = require("@comunica/bus-rdf-source-identifier");
/**
 * A comunica SPARQL RDF Source Identifier Actor.
 */
class ActorRdfSourceIdentifierSparql extends bus_rdf_source_identifier_1.ActorRdfSourceIdentifier {
    constructor(args) {
        super(args);
    }
    async test(action) {
        if (!action.sourceValue.startsWith('http')) {
            throw new Error(`Actor ${this.name} can only detect SPARQL endpoints hosted via HTTP(S).`);
        }
        const url = action.sourceValue + '?query=' + encodeURIComponent('ASK { ?s a ?o }');
        const headers = new Headers();
        headers.append('Accept', 'application/sparql-results+json');
        const httpAction = { context: action.context, input: url, init: { headers, method: 'HEAD' } };
        const httpResponse = await this.mediatorHttp.mediate(httpAction);
        if (!httpResponse.ok || httpResponse.headers.get('Content-Type').indexOf('application/sparql-results+json') < 0) {
            throw new Error(`${action.sourceValue} is not a SPARQL endpoint`);
        }
        return { priority: this.priority };
    }
    async run(action) {
        return { sourceType: 'sparql' };
    }
}
exports.ActorRdfSourceIdentifierSparql = ActorRdfSourceIdentifierSparql;
//# sourceMappingURL=ActorRdfSourceIdentifierSparql.js.map